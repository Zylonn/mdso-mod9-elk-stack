metricbeat.modules:
  - module: elasticsearch
    xpack.enabled: true
    period: 10s
    hosts: ${ELASTIC_HOSTS}
    ssl.enabled: true
    ssl.certificate_authorities: "certs/ca/ca.crt"
    username: ${ELASTIC_USER}
    password: ${ELASTIC_PASSWORD}

  - module: kibana
    xpack.enabled: true
    metricsets:
      - stats
    period: 10s
    hosts: ${KIBANA_HOSTS}
    username: ${ELASTIC_USER}
    password: ${ELASTIC_PASSWORD}

  - module: docker
    metricsets:
      - container
      - cpu
      - diskio
      - healthcheck
      - info
      - memory
      - network
    hosts: ["unix:///var/run/docker.sock"]
    period: 10s
    enabled: true

processors:
  - add_host_metadata: {}
  - add_docker_metadata: {}

# Opcional: que Metricbeat pueda cargar assets en Kibana (dashboards, etc.)
setup.kibana:
  host: ${KIBANA_HOSTS}

output.elasticsearch:
  hosts: ${ELASTIC_HOSTS}
  username: ${ELASTIC_USER}
  password: ${ELASTIC_PASSWORD}
  ssl:
    certificate_authorities: "certs/ca/ca.crt"
    verification_mode: full